# üéØ –û—Ç—á–µ—Ç –æ –º–∏–≥—Ä–∞—Ü–∏–∏: VNC ‚Üí Telegram Web App

**–î–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:** 30 –∞–≤–≥—É—Å—Ç–∞ 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û**

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Telegram Bot –¥–ª—è Web App –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [x] –ó–∞–º–µ–Ω–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã `/launch` ‚Üí `/webapp`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã inline keyboard –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Web App API
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã web_app –∫–Ω–æ–ø–∫–∏ –≤–º–µ—Å—Ç–æ –≤–Ω–µ—à–Ω–∏—Ö —Å—Å—ã–ª–æ–∫
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã welcome —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ Web App

### ‚úÖ 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ backend —Ä–æ—É—Ç–æ–≤ –≤ index.js
- [x] –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ VNC callbacks (`onGetBrowserUrl`)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `handleStartBrowser` –∏ `handleStopBrowser`
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WebAppManager –≤–º–µ—Å—Ç–æ TorBrowserManager + VNC
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã WebSocket –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è Web App –¥–µ–π—Å—Ç–≤–∏–π

### ‚úÖ 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Web App –∫–Ω–æ–ø–æ–∫ –≤ Telegram Bot
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã bot commands —Å Web App –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- [x] Inline keyboard –∫–Ω–æ–ø–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `web_app` –ø–∞—Ä–∞–º–µ—Ç—Ä
- [x] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ URL –¥–ª—è Telegram Web App

### ‚úÖ 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞
- [x] –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `ws`, `child_process`, `novnc`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω package.json —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- [x] –£–±—Ä–∞–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥ VNC/TorBrowserManager –∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### ‚úÖ 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [x] –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [x] –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [x] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
- [x] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

---

## üèóÔ∏è –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–∏ (VNC-based):
```
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram] ‚Üí [Telegram Bot] ‚Üí [Node.js API] ‚Üí [Docker] ‚Üí [Tor Browser] ‚Üí [VNC Server] ‚Üí [noVNC Web UI] ‚Üí [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å]
```

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (Web App-based):
```
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram] ‚Üí [Telegram Bot] ‚Üí [Telegram Web App] ‚Üí [Node.js API] ‚Üí [WebApp Manager] ‚Üí [Puppeteer + Tor Proxy] ‚Üí [.onion –°–∞–π—Ç—ã]
                                                          ‚Üì
                                                  [Web3 Service] ‚Üí [MetaMask/Wallet]
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `src/index.js` - –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä —Å Web App —Ä–æ—É—Ç–∞–º–∏
- `src/telegramBot.js` - Telegram –±–æ—Ç —Å Web App –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- `src/webAppManager.js` - –ú–µ–Ω–µ–¥–∂–µ—Ä –±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö —Å–µ—Å—Å–∏–π —á–µ—Ä–µ–∑ Puppeteer
- `frontend/webapp.html` - Telegram Web App –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `package.json` - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### üìÑ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `README_WEBAPP.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è Web App –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- `test-components.js` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- `test-server.js` - –¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
- `MIGRATION_REPORT.md` - –≠—Ç–æ—Ç –æ—Ç—á–µ—Ç

### üìÅ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏):
- `src/vncServer.js` - –°—Ç–∞—Ä—ã–π VNC —Å–µ—Ä–≤–µ—Ä
- `src/torBrowserManager.js` - –°—Ç–∞—Ä—ã–π Tor –º–µ–Ω–µ–¥–∂–µ—Ä
- `frontend/vnc.html` - –°—Ç–∞—Ä—ã–π VNC –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `frontend/index.html` - –°—Ç–∞—Ä—ã–π –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

## üîß –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. Telegram Bot API
```javascript
// –î–û:
{ text: 'üßÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å Tor Browser', callback_data: 'launch_browser' }

// –ü–û–°–õ–ï:
{ text: 'üßÖ –û—Ç–∫—Ä—ã—Ç—å Tor Browser', web_app: { url: process.env.BASE_URL + '/webapp' } }
```

### 2. Backend Session Management
```javascript
// –î–û:
const result = await this.torBrowserManager.startBrowser(sessionId, options);
const vncData = await this.vncServer.startSession(sessionId, browserData.display);

// –ü–û–°–õ–ï:
const webAppSession = await this.webAppManager.startBrowserSession(sessionId, {
    userAgent: options.userAgent || 'desktop'
});
```

### 3. Frontend Architecture
```javascript
// –î–û: VNC –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ noVNC
const rfb = new RFB(canvas, wsURL);

// –ü–û–°–õ–ï: Telegram Web App API
const tg = window.Telegram?.WebApp;
tg.ready();
```

---

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- **Web3Service**: ‚úÖ –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç
- **WebAppManager**: ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ viewport, –ø—Ä–æ–≤–µ—Ä–∫–∞ URL, —Å–µ—Å—Å–∏–∏
- **API Routes**: ‚úÖ –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **Dependencies**: ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
- **Tor**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `sudo apt install tor`
- **Chrome/Chromium**: –î–ª—è Puppeteer
- **Telegram Bot Token**: –û—Ç @BotFather
- **SSL Certificate**: –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω Web App

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
sudo apt update
sudo apt install tor chromium-browser

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
git clone <repository>
cd web3-tor-browser-app
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞:
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp .env.example .env
nano .env
```

### 3. Telegram Bot:
1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ domain –¥–ª—è Web App

### 4. –ó–∞–ø—É—Å–∫:
```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –ü—Ä–æ–¥–∞–∫—à–Ω
npm start
```

---

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### ‚úÖ –£–ª—É—á—à–µ–Ω–∏—è:
- üì± **–ù–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram** - Web App –ø—Ä—è–º–æ –≤ –∫–ª–∏–µ–Ω—Ç–µ
- üöÄ **–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫** - –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
- üìâ **–ú–µ–Ω—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤** - Puppeteer –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ + VNC
- üîí **–õ—É—á—à–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö VNC –ø–æ—Ä—Ç–æ–≤
- üì± **–ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ü—Ä—è–º–æ–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ Telegram

### üîÑ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã:
- üßÖ **Tor –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å** - –í–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ Tor
- üö´ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–æ–≤** - –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- üåç **Web3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—å–∫–æ–≤
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ò–∑–æ–ª—è—Ü–∏—è —Å–µ—Å—Å–∏–π

---

## üéØ –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏

**üü¢ –ú–ò–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û**

- ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- ‚úÖ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Frontend Web App –≥–æ—Ç–æ–≤
- ‚úÖ Telegram Bot –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [README_WEBAPP.md](./README_WEBAPP.md)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `node test-components.js` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `node test-server.js` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ú–∏–≥—Ä–∞—Ü–∏—è –æ—Ç VNC –∫ Telegram Web App –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!** üéä
